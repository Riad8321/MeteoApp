<main class="main">
  <div class="hero">
    <img src="../logo.png" alt="Logo MÃ©tÃ©oApp" class="logo" />
    <p>PrÃ©visions mÃ©tÃ©o en temps rÃ©el, simples et Ã©lÃ©gantes</p>
  </div>

  <div class="recherche">
    <input
      type="text"
      [(ngModel)]="villeSaisie"
      placeholder="Entrez une ville"
    />
    <button class="boutonrecherche" (click)="recherchemeteo()">
      Voir la mÃ©tÃ©o
    </button>
  </div>

  <div class="selects">
    <select [(ngModel)]="regionSelectionnee" (ngModelChange)="onRegionChange()">
      <option value="">Choisir une rÃ©gion</option>
      <option *ngFor="let r of regions" [value]="r.code">
        {{ r.nom }}
      </option>
    </select>

    <select
      [(ngModel)]="departementSelectionne"
      (ngModelChange)="onDepartementChange()"
      [disabled]="!departements.length"
    >
      <option value="">Choisir un dÃ©partement</option>
      <option *ngFor="let d of departements" [value]="d.code">
        {{ d.nom }}
      </option>
    </select>

    <select
      [(ngModel)]="villeSelectionnee"
      (ngModelChange)="onVilleChange()"
      [disabled]="!villes.length"
    >
      <option value="">Choisir une ville</option>
      <option *ngFor="let v of villes" [value]="v.nom">
        {{ v.nom }}
      </option>
    </select>
  </div>

  @if (resultatsmeteo) {
    <div class="carte-meteo">
      <h3>MÃ©tÃ©o Ã  {{ resultatsmeteo.location.name }}</h3>

      <p>ğŸŒ¡ï¸ TempÃ©rature : {{ resultatsmeteo.current.temp_c }}Â°</p>

      <p>
        Condition :
        <img [src]="resultatsmeteo.current.condition.icon" />
      </p>

      <div class="buttons-container">
        <button class="add-btn" (click)="addToFavorites()">
          Ajouter Ã  la liste
        </button>

        <button class="details-btn" (click)="deplierDetails()">
          {{ afficherDetails ? 'Masquer les dÃ©tails' : 'Afficher plus de dÃ©tails' }}
        </button>
      </div>

      @if (afficherDetails) {
        <div class="details">
          <p>ğŸŒ¬ï¸ Vent : {{ resultatsmeteo.current.wind_kph }} km/h</p>
          <p>ğŸ˜ Ressenti : {{ resultatsmeteo.current.feelslike_c }}Â°</p>
          <p>ğŸ’§ HumiditÃ© : {{ resultatsmeteo.current.humidity }}%</p>
          <p>ğŸ§­ Direction : {{ resultatsmeteo.current.wind_dir }}</p>
          <p>ğŸŒ«ï¸ VisibilitÃ© : {{ resultatsmeteo.current.vis_km }} km</p>
          <p>ğŸŒ¡ï¸ Pression : {{ resultatsmeteo.current.pressure_mb }} mb</p>
          <p>â˜€ï¸ UV : {{ resultatsmeteo.current.uv }}</p>
        </div>
      }
    </div>

    @if (favorites.length > 0) {
      <div class="library-header">
        <h2>ğŸ“š Ma liste</h2>
        <button class="sort-btn" (click)="sortFavorites()">
          Trier {{ sortAsc ? 'Z â†’ A' : 'A â†’ Z' }}
        </button>
      </div>

      <div class="library">
        <div class="library-row">
          @for (fav of favorites; let i = $index; track i) {
            <div class="library-card">
              <h4>{{ fav?.data?.location?.name }}</h4>
              <p>{{ fav.data.current.temp_c }}Â°</p>
              <img [src]="fav.data.current.condition.icon" />

              <div class="library-actions">
                <button (click)="toggleFavoriteDetails(i)">
                  {{ fav.showDetails ? 'Masquer' : 'DÃ©tails' }}
                </button>

                <button class="danger" (click)="removeFromFavorites(i)">
                  Retirer
                </button>
              </div>

              @if (fav.showDetails) {
                <div class="details">
                  <p>ğŸŒ¬ï¸ Vent : {{ fav.data.current.wind_kph }} km/h</p>
                  <p>ğŸ’§ HumiditÃ© : {{ fav.data.current.humidity }}%</p>
                  <p>â˜€ï¸ UV : {{ fav.data.current.uv }}</p>
                  <p>ğŸŒ¡ï¸ Ressenti : {{ fav.data.current.feelslike_c }}Â°</p>
                </div>
              }
            </div>
          }
        </div>
      </div>
    }
  } @else {
    <div class="empty-state">
      <p>Entrez une ville pour voir la mÃ©tÃ©o â˜ï¸</p>
    </div>
  }
</main>

<router-outlet></router-outlet>
